<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="VHD/VHDX简介 什么是VHD VHD 是Microsoft Virtual Hard Disk format（微软虚拟磁盘文件）的简称。可以由Windows Vista/7/8/10，Windows Server 2008R2 等系统创建。
一个VHD文件可以被虚拟为一块硬盘，并且可以像操作一块硬盘一样操作VHD文件，例如：读取、写入、创建分区、格式化等等。
什么是VHDX 随着虚拟环境的企业工作负荷的增加以及性能要求的提高，虚拟硬盘 (VHD) 格式需要适应这些变化。因此，Windows Server 2012 中的 Hyper-V 引入了一个新版本的VHD格式，称为VHDX。
与旧的VHD格式相比，VHDX具有更大的存储容量。它优化了动态磁盘和差异磁盘的结构对齐方式，以防止在新的大型扇区物理磁盘上性能降级。同时还能在电源故障期间提供数据损坏保护。
VHDX格式的主要新功能如下：
 支持的虚拟硬盘的存储容量高达 64 TB。 通过记录对VHDX元数据结构的更新，可以在电源发生故障时保护数据不会被损坏。 改进了虚拟硬盘格式的对齐方式，可在大型扇区磁盘上更好地工作。  VHDX 格式还提供以下功能：
 动态磁盘和差异磁盘有较大的数据块大小，可让这些磁盘满足工作负荷的需求。 拥有4KB的逻辑扇区，可以在为4KB扇区设计的应用程序和作负荷使用该磁盘时提供较高的性能。 能够存储有关用户可能想记录的文件的自定义元数据，如操作系统版本或应用的修补程序。 高效地表示数据（也称为“剪裁”），使文件大小更小并且允许基础物理存储设备回收未使用的空间。（剪裁需要直接连接到虚拟机或 SCSI 磁盘的物理磁盘以及与剪裁兼容的硬件。)  VHD/VHDX的优点   维护简单
 操作VHD就和操作物理硬盘一样，我们可以对其进行分区、格式化、压缩、删除等等操作，并且这些操作并不会影响你的物理分区。    加载自如
 VHD磁盘可以进行分离操作，这样在磁盘管理中就无法找到VHD磁盘分区。如果想要再次挂载，只需对VHD磁盘文件进行挂载操作即可。    轻松备份
 备份时仅需要将 .vhd/.vhdx 文件进行备份，文件中所包含的所有信息(包括分区表等信息)就被备份下来了。    迁移方便
 只需要将 .vhd/.vhdx 文件复制到目标计算机上，再进行附加操作即可完成迁移。也可以通过服务器进行分发。也可以在物理机和虚拟机之间进行迁移。    VHD系统的特点 安装简便 VHD系统安装非常简单，到了Windows10系统更是如此，甚至可以从别的电脑上拷一个Windows10的VHD来启动，类似于即插即用。"><title>使用VHD创建本地虚拟系统</title><link rel=canonical href=https://chaosalphard.github.io/p/%E4%BD%BF%E7%94%A8vhd%E5%88%9B%E5%BB%BA%E6%9C%AC%E5%9C%B0%E8%99%9A%E6%8B%9F%E7%B3%BB%E7%BB%9F/><link rel=stylesheet href=/scss/style.min.css><meta property="og:title" content="使用VHD创建本地虚拟系统"><meta property="og:description" content="VHD/VHDX简介 什么是VHD VHD 是Microsoft Virtual Hard Disk format（微软虚拟磁盘文件）的简称。可以由Windows Vista/7/8/10，Windows Server 2008R2 等系统创建。
一个VHD文件可以被虚拟为一块硬盘，并且可以像操作一块硬盘一样操作VHD文件，例如：读取、写入、创建分区、格式化等等。
什么是VHDX 随着虚拟环境的企业工作负荷的增加以及性能要求的提高，虚拟硬盘 (VHD) 格式需要适应这些变化。因此，Windows Server 2012 中的 Hyper-V 引入了一个新版本的VHD格式，称为VHDX。
与旧的VHD格式相比，VHDX具有更大的存储容量。它优化了动态磁盘和差异磁盘的结构对齐方式，以防止在新的大型扇区物理磁盘上性能降级。同时还能在电源故障期间提供数据损坏保护。
VHDX格式的主要新功能如下：
 支持的虚拟硬盘的存储容量高达 64 TB。 通过记录对VHDX元数据结构的更新，可以在电源发生故障时保护数据不会被损坏。 改进了虚拟硬盘格式的对齐方式，可在大型扇区磁盘上更好地工作。  VHDX 格式还提供以下功能：
 动态磁盘和差异磁盘有较大的数据块大小，可让这些磁盘满足工作负荷的需求。 拥有4KB的逻辑扇区，可以在为4KB扇区设计的应用程序和作负荷使用该磁盘时提供较高的性能。 能够存储有关用户可能想记录的文件的自定义元数据，如操作系统版本或应用的修补程序。 高效地表示数据（也称为“剪裁”），使文件大小更小并且允许基础物理存储设备回收未使用的空间。（剪裁需要直接连接到虚拟机或 SCSI 磁盘的物理磁盘以及与剪裁兼容的硬件。)  VHD/VHDX的优点   维护简单
 操作VHD就和操作物理硬盘一样，我们可以对其进行分区、格式化、压缩、删除等等操作，并且这些操作并不会影响你的物理分区。    加载自如
 VHD磁盘可以进行分离操作，这样在磁盘管理中就无法找到VHD磁盘分区。如果想要再次挂载，只需对VHD磁盘文件进行挂载操作即可。    轻松备份
 备份时仅需要将 .vhd/.vhdx 文件进行备份，文件中所包含的所有信息(包括分区表等信息)就被备份下来了。    迁移方便
 只需要将 .vhd/.vhdx 文件复制到目标计算机上，再进行附加操作即可完成迁移。也可以通过服务器进行分发。也可以在物理机和虚拟机之间进行迁移。    VHD系统的特点 安装简便 VHD系统安装非常简单，到了Windows10系统更是如此，甚至可以从别的电脑上拷一个Windows10的VHD来启动，类似于即插即用。"><meta property="og:url" content="https://chaosalphard.github.io/p/%E4%BD%BF%E7%94%A8vhd%E5%88%9B%E5%BB%BA%E6%9C%AC%E5%9C%B0%E8%99%9A%E6%8B%9F%E7%B3%BB%E7%BB%9F/"><meta property="og:site_name" content="Ilirus"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="Windows"><meta property="article:published_time" content="2018-05-20T10:30:12+00:00"><meta property="article:modified_time" content="2018-05-20T10:30:12+00:00"><meta name=twitter:title content="使用VHD创建本地虚拟系统"><meta name=twitter:description content="VHD/VHDX简介 什么是VHD VHD 是Microsoft Virtual Hard Disk format（微软虚拟磁盘文件）的简称。可以由Windows Vista/7/8/10，Windows Server 2008R2 等系统创建。
一个VHD文件可以被虚拟为一块硬盘，并且可以像操作一块硬盘一样操作VHD文件，例如：读取、写入、创建分区、格式化等等。
什么是VHDX 随着虚拟环境的企业工作负荷的增加以及性能要求的提高，虚拟硬盘 (VHD) 格式需要适应这些变化。因此，Windows Server 2012 中的 Hyper-V 引入了一个新版本的VHD格式，称为VHDX。
与旧的VHD格式相比，VHDX具有更大的存储容量。它优化了动态磁盘和差异磁盘的结构对齐方式，以防止在新的大型扇区物理磁盘上性能降级。同时还能在电源故障期间提供数据损坏保护。
VHDX格式的主要新功能如下：
 支持的虚拟硬盘的存储容量高达 64 TB。 通过记录对VHDX元数据结构的更新，可以在电源发生故障时保护数据不会被损坏。 改进了虚拟硬盘格式的对齐方式，可在大型扇区磁盘上更好地工作。  VHDX 格式还提供以下功能：
 动态磁盘和差异磁盘有较大的数据块大小，可让这些磁盘满足工作负荷的需求。 拥有4KB的逻辑扇区，可以在为4KB扇区设计的应用程序和作负荷使用该磁盘时提供较高的性能。 能够存储有关用户可能想记录的文件的自定义元数据，如操作系统版本或应用的修补程序。 高效地表示数据（也称为“剪裁”），使文件大小更小并且允许基础物理存储设备回收未使用的空间。（剪裁需要直接连接到虚拟机或 SCSI 磁盘的物理磁盘以及与剪裁兼容的硬件。)  VHD/VHDX的优点   维护简单
 操作VHD就和操作物理硬盘一样，我们可以对其进行分区、格式化、压缩、删除等等操作，并且这些操作并不会影响你的物理分区。    加载自如
 VHD磁盘可以进行分离操作，这样在磁盘管理中就无法找到VHD磁盘分区。如果想要再次挂载，只需对VHD磁盘文件进行挂载操作即可。    轻松备份
 备份时仅需要将 .vhd/.vhdx 文件进行备份，文件中所包含的所有信息(包括分区表等信息)就被备份下来了。    迁移方便
 只需要将 .vhd/.vhdx 文件复制到目标计算机上，再进行附加操作即可完成迁移。也可以通过服务器进行分发。也可以在物理机和虚拟机之间进行迁移。    VHD系统的特点 安装简便 VHD系统安装非常简单，到了Windows10系统更是如此，甚至可以从别的电脑上拷一个Windows10的VHD来启动，类似于即插即用。"></head><body class="article-page has-toc"><script>(function(){const a='StackColorScheme';localStorage.getItem(a)||localStorage.setItem(a,"auto")})()</script><script>(function(){const b='StackColorScheme',a=localStorage.getItem(b),c=window.matchMedia('(prefers-color-scheme: dark)').matches===!0;a=='dark'||a==='auto'&&c?document.documentElement.dataset.scheme='dark':document.documentElement.dataset.scheme='light'})()</script><div class="container main-container flex
extended"><div id=article-toolbar><a href=https://chaosalphard.github.io class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg><span>返回</span></a></div><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/%E5%85%B6%E4%BB%96/>其他</a></header><h2 class=article-title><a href=/p/%E4%BD%BF%E7%94%A8vhd%E5%88%9B%E5%BB%BA%E6%9C%AC%E5%9C%B0%E8%99%9A%E6%8B%9F%E7%B3%BB%E7%BB%9F/>使用VHD创建本地虚拟系统</a></h2><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>May 20, 2018</time></div></footer></div></header><section class=article-content><h1 id=vhdvhdx简介>VHD/VHDX简介</h1><h2 id=什么是vhd>什么是VHD</h2><p>VHD 是Microsoft Virtual Hard Disk format（微软虚拟磁盘文件）的简称。可以由Windows Vista/7/8/10，Windows Server 2008R2 等系统创建。<br>一个VHD文件可以被虚拟为一块硬盘，并且可以像操作一块硬盘一样操作VHD文件，例如：读取、写入、创建分区、格式化等等。</p><h2 id=什么是vhdx>什么是VHDX</h2><p>随着虚拟环境的企业工作负荷的增加以及性能要求的提高，虚拟硬盘 (VHD) 格式需要适应这些变化。因此，Windows Server 2012 中的 Hyper-V 引入了一个新版本的VHD格式，称为VHDX。<br>与旧的VHD格式相比，VHDX具有更大的存储容量。它优化了动态磁盘和差异磁盘的结构对齐方式，以防止在新的大型扇区物理磁盘上性能降级。同时还能在电源故障期间提供数据损坏保护。</p><p>VHDX格式的主要新功能如下：</p><ul><li>支持的虚拟硬盘的存储容量高达 64 TB。</li><li>通过记录对VHDX元数据结构的更新，可以在电源发生故障时保护数据不会被损坏。</li><li>改进了虚拟硬盘格式的对齐方式，可在大型扇区磁盘上更好地工作。</li></ul><p>VHDX 格式还提供以下功能：</p><ul><li>动态磁盘和差异磁盘有较大的数据块大小，可让这些磁盘满足工作负荷的需求。</li><li>拥有4KB的逻辑扇区，可以在为4KB扇区设计的应用程序和作负荷使用该磁盘时提供较高的性能。</li><li>能够存储有关用户可能想记录的文件的自定义元数据，如操作系统版本或应用的修补程序。</li><li>高效地表示数据（也称为“剪裁”），使文件大小更小并且允许基础物理存储设备回收未使用的空间。（剪裁需要直接连接到虚拟机或 SCSI 磁盘的物理磁盘以及与剪裁兼容的硬件。)</li></ul><h2 id=vhdvhdx的优点>VHD/VHDX的优点</h2><ul><li><p>维护简单</p><ul><li>操作VHD就和操作物理硬盘一样，我们可以对其进行分区、格式化、压缩、删除等等操作，并且这些操作并不会影响你的物理分区。</li></ul></li><li><p>加载自如</p><ul><li>VHD磁盘可以进行分离操作，这样在磁盘管理中就无法找到VHD磁盘分区。如果想要再次挂载，只需对VHD磁盘文件进行挂载操作即可。</li></ul></li><li><p>轻松备份</p><ul><li>备份时仅需要将 .vhd/.vhdx 文件进行备份，文件中所包含的所有信息(包括分区表等信息)就被备份下来了。</li></ul></li><li><p>迁移方便</p><ul><li>只需要将 .vhd/.vhdx 文件复制到目标计算机上，再进行附加操作即可完成迁移。也可以通过服务器进行分发。也可以在物理机和虚拟机之间进行迁移。</li></ul></li></ul><h1 id=vhd系统的特点>VHD系统的特点</h1><h2 id=安装简便>安装简便</h2><p>VHD系统安装非常简单，到了Windows10系统更是如此，甚至可以从别的电脑上拷一个Windows10的VHD来启动，类似于即插即用。</p><h2 id=性能强劲>性能强劲</h2><p>VHD系统如同真实的系统一样，可以直接使用计算机的物理硬件，性能与真实系统相差无几，这与虚拟机有明显的差别。虚拟机使用虚拟出来的硬件，VHD系统直接使用物理硬件。</p><h2 id=备份方便>备份方便</h2><p>直接将 .vhd/.vhdx 文件复制一份，就完成了备份工作。<br>此外，VHD还提供了更为方便的备份技术——“差分磁盘”。使用差分磁盘，即可实现系统的“秒备份”，“秒还原”。</p><h2 id=删除方便>删除方便</h2><p>当你不想使用VHD系统时，只需要将对应的 .vhd/.vhdx 文件删除，再将对应的引导条目删除即可。</p><h1 id=如何部署vhd系统>如何部署VHD系统</h1><p>如果你从网络上或者你朋友那里获得了部署有Windows10系统的vhd/vhdx文件，只需将其拷入你的计算机，然后添加引导项即可完成VHD系统的部署。</p><p>如果没有也没关系，下面将会介绍如何从零开始部署VHD系统</p><h2 id=创建vhdvhdx文件>创建VHD/VHDX文件</h2><p><strong>以下命令均在Windows10环境下进行，Windows7可能略有不同</strong></p><p>使用Windows磁盘管理创建</p><p>创建vhdx文件<br><figure><a href=https://s2.ax1x.com/2019/06/16/V7kaxH.jpg><img src=https://s2.ax1x.com/2019/06/16/V7kaxH.jpg loading=lazy></a></figure></p><p>设置大小<br><figure><a href=https://s2.ax1x.com/2019/06/16/V7kwMd.jpg><img src=https://s2.ax1x.com/2019/06/16/V7kwMd.jpg loading=lazy></a></figure></p><p>初始化磁盘，GPT还是MBR看个人情况，推荐选GPT格式<br><figure><a href=https://s2.ax1x.com/2019/06/16/V7k0sA.jpg><img src=https://s2.ax1x.com/2019/06/16/V7k0sA.jpg loading=lazy></a></figure></p><p>新建分区<br><figure><a href=https://s2.ax1x.com/2019/06/16/V7kBqI.jpg><img src=https://s2.ax1x.com/2019/06/16/V7kBqI.jpg loading=lazy></a></figure></p><p>完成</p><p>使用命令行创建</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=c1>#启动diskpart工具</span>
diskpart

<span class=c1>#创建一个大小为25600MB的固定大小的vhdx文件</span>
<span class=c1>#如果想创建动态拓展大小的vhdx文件，换成type=expandable即可</span>
create vdisk <span class=nv>file</span><span class=o>=</span>E:<span class=se>\v</span>hd.vhdx <span class=nv>maximum</span><span class=o>=</span><span class=m>25600</span> <span class=nv>type</span><span class=o>=</span>fixed

<span class=c1>#选中刚才创建的vhdx文件</span>
<span class=k>select</span> vdisk <span class=nv>file</span><span class=o>=</span>E:<span class=se>\v</span>hd.vhdx

<span class=c1>#挂载硬盘</span>
attach vdisk

<span class=c1>#创建主分区</span>
create partition primary

<span class=c1>#设置卷标</span>
assign <span class=nv>letter</span><span class=o>=</span>V

<span class=c1>#格式化分区</span>
format quick <span class=nv>label</span><span class=o>=</span>vhdx

<span class=nb>exit</span>
</code></pre></div><p>完成</p><h2 id=部署windows系统到vhd虚拟磁盘>部署Windows系统到VHD虚拟磁盘</h2><p><strong>首先将vhdx文件挂载到系统上，如果已挂载则可跳过这一步</strong></p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>diskpart

<span class=k>select</span> vdisk <span class=nv>file</span><span class=o>=</span>E:<span class=se>\v</span>hd.vhdx

attach vdisk

<span class=nb>exit</span>
</code></pre></div><p><strong>将系统部署到vhdx文件中</strong></p><p>下载.iso镜像文件或者.wim映像文件。<br>如果是.iso镜像文件则将其解压或者挂载到虚拟光驱。</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=c1>#获得镜像信息</span>
Dism /Get-ImageInfo /imagefile:D:<span class=se>\W</span>indows10<span class=se>\s</span>ources<span class=se>\i</span>nstall.wim

<span class=c1>#部署镜像到vhdx中</span>
Dism /apply-image /imagefile:D:<span class=se>\W</span>indows10<span class=se>\s</span>ources<span class=se>\i</span>nstall.wim /index:1 /ApplyDir:V:<span class=se>\
</span></code></pre></div><p>等待部署完成</p><p>参数解释：<br>imagefile: install.wim文件所在的位置<br>index: 系统版本所对应的索引路径<br>ApplyDir: 要部署镜像的驱动器盘符</p><h2 id=添加引导项>添加引导项</h2><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=c1>#将V盘的系统添加到引导项，V即为你vhd虚拟磁盘的盘符</span>
bcdboot V:<span class=se>\W</span>indows /l zh-CN /d
</code></pre></div><p>如果你是在PE下进行的，则需要为ESP分区分配盘符</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>bcdboot V:<span class=se>\W</span>indows /s Z: /f uefi /l zh-cn /d
</code></pre></div><p>参数解释：<br>/l: 语言<br>/s: 要将引导文件复制到的磁盘的盘符，通常是ESP分区所在位置<br>/f: 引导方式<br>/d: 保留现在的默认启动条目</p><p>使用bcdedit指令来查看引导项，或者用msconfig来查看引导项。</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=se>\&gt;</span>bcdedit

Windows 启动管理器
--------------------
标识符                  <span class=o>{</span>bootmgr<span class=o>}</span>
device                  <span class=nv>partition</span><span class=o>=</span><span class=se>\D</span>evice<span class=se>\H</span>arddiskVolume1
path                    <span class=se>\E</span>FI<span class=se>\M</span>icrosoft<span class=se>\B</span>oot<span class=se>\b</span>ootmgfw.efi
description             Windows Boot Manager
locale                  zh-CN
inherit                 <span class=o>{</span>globalsettings<span class=o>}</span>
default                 <span class=o>{</span>default<span class=o>}</span>
resumeobject            <span class=o>{</span>3fa12b79-202e-11e8-8e30-ddc8fe2935d0<span class=o>}</span>
displayorder            <span class=o>{</span>default<span class=o>}</span>
                        <span class=o>{</span>current<span class=o>}</span>
toolsdisplayorder       <span class=o>{</span>memdiag<span class=o>}</span>
timeout                 <span class=m>5</span>

Windows 启动加载器
-------------------
标识符                  <span class=o>{</span>current<span class=o>}</span>
device                  <span class=nv>partition</span><span class=o>=</span>C:
path                    <span class=se>\W</span>indows<span class=se>\s</span>ystem32<span class=se>\w</span>inload.efi
description             SSD Win10
locale                  zh-CN
inherit                 <span class=o>{</span>bootloadersettings<span class=o>}</span>
recoverysequence        <span class=o>{</span>3fa12b6f-202e-11e8-8e30-ddc8fe2935d0<span class=o>}</span>
recoveryenabled         Yes
isolatedcontext         Yes
allowedinmemorysettings 0x15000075
osdevice                <span class=nv>partition</span><span class=o>=</span>C:
systemroot              <span class=se>\W</span>indows
resumeobject            <span class=o>{</span>3fa12b79-202e-11e8-8e30-ddc8fe2935d0<span class=o>}</span>
nx                      OptIn
bootmenupolicy          Standard

Windows 启动加载器
-------------------
标识符                  <span class=o>{</span>3fa12b75-202e-11e8-8e30-ddc8fe2935d0<span class=o>}</span>
device                  <span class=nv>partition</span><span class=o>=</span>E:
path                    <span class=se>\W</span>indows<span class=se>\s</span>ystem32<span class=se>\w</span>inload.efi
description             Virtual Win10
locale                  zh-CN
inherit                 <span class=o>{</span>bootloadersettings<span class=o>}</span>
isolatedcontext         Yes
allowedinmemorysettings 0x15000075
osdevice                <span class=nv>partition</span><span class=o>=</span>E:
systemroot              <span class=se>\W</span>indows
resumeobject            <span class=o>{</span>3fa12b75-202e-11e8-8e30-ddc8fe2935d0<span class=o>}</span>
nx                      OptIn
bootmenupolicy          Standard
</code></pre></div><p>使用<code>bcdedit /set</code>指令来为启动项命名</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=c1>#bcdedit /set {标识符} description &#34;要更改的启动项名称&#34;</span>
bcdedit /set <span class=o>{</span>3fa12b75-202e-11e8-8e30-ddc8fe2935d0<span class=o>}</span> description <span class=s2>&#34;VW10&#34;</span>
</code></pre></div><p>取消挂载，重启电脑，引导进入VHD系统即可</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>diskpart

<span class=k>select</span> vdisk <span class=nv>file</span><span class=o>=</span>E:<span class=se>\v</span>hd.vhdx

detach vdisk

<span class=nb>exit</span>
</code></pre></div><h1 id=使用差分磁盘进行备份和还原>使用差分磁盘进行备份和还原</h1><h2 id=差分磁盘如何实现秒备份秒还原>差分磁盘如何实现“秒备份”，“秒还原”</h2><p>差分磁盘是指基于父盘的子盘，子盘能读取父盘的所有数据，同时对子盘的所有改动不会影响到父盘。<br>因此，一旦建立了子盘，就相当于为父盘建立了一个还原点，由于子盘自身不带数据，所以创建非常快，大小非常小(4MB左右)，子盘的大小会随着子盘的使用逐渐增大。<br>同时，如果想要还原，只需要再次为父盘创建一个子盘即可，原来的子盘同样可以使用或删除。</p><p>基于此，使用差分磁盘可以使用最少的空间，创建多个系统，供不同的人使用。并且备份和还原对硬盘的损伤也降到了最低。</p><p><strong>创建差分磁盘</strong></p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>diskpart
create vdisk <span class=nv>file</span><span class=o>=</span>E:<span class=se>\V</span>Disk<span class=se>\c</span>hild01.vhdx <span class=nv>parent</span><span class=o>=</span>E:<span class=se>\V</span>Disk<span class=se>\v</span>hd.vhdx
<span class=nb>exit</span>
</code></pre></div><p>参数解释：<br>file: 创建的子盘的位置和名称<br>parent: 父盘的位置</p><p><strong>将子盘添加到启动项</strong></p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>diskpart
<span class=k>select</span> vdisk <span class=nv>file</span><span class=o>=</span>E:<span class=se>\V</span>Disk<span class=se>\c</span>hild01.vhdx
attach vdisk
<span class=nb>exit</span>
bcdboot V:<span class=se>\W</span>indows /l zh-CN /d
</code></pre></div><p>子盘的启动项名称同样可以通过<code>bcdedit /set</code>指令更改。</p><p>由于子盘是基于父盘的数据创建的，创建完毕的子盘和父盘的数据是一模一样的，但是父盘内的数据就无法修改，否则会导致子盘数据错误，无法打开。<br>因此，将父盘的vhdx文件设为“只读”属性，同时在Win+R的运行框中输入msconfig，进入启动项管理，将父盘的启动项删除。</p><p>以后进行还原操作时，只需要将原本的子盘删除，创建一个新子盘，再将其添加到启动项即可。你也可以将指令写为bat批处理，双击执行。</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>del E:<span class=se>\V</span>Disk<span class=se>\c</span>hild01.vhdx
diskpart
    create vdisk <span class=nv>file</span><span class=o>=</span>E:<span class=se>\V</span>Disk<span class=se>\c</span>hild01.vhdx <span class=nv>parent</span><span class=o>=</span>E:<span class=se>\V</span>Disk<span class=se>\v</span>hd.vhdx
    <span class=k>select</span> vdisk <span class=nv>file</span><span class=o>=</span>E:<span class=se>\V</span>Disk<span class=se>\c</span>hild01.vhdx
    attach vdisk
<span class=nb>exit</span>
bcdboot V:<span class=se>\W</span>indows /l zh-CN /d
</code></pre></div></section><footer class=article-footer><section class=article-tags><a href=/tags/windows/>Windows</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-contents--wrapper><h2 class=section-title>相关文章</h2><div class=related-contents><div class="flex article-list--tile"><article><a href=/p/%E5%9C%A8windows%E7%9A%84uac%E6%8E%88%E6%9D%83%E4%B8%AD%E5%A2%9E%E5%8A%A0%E5%AF%86%E7%A0%81%E9%AA%8C%E8%AF%81/><div class=article-details><h2 class=article-title>在Windows的UAC授权中增加密码验证</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2020 -
2024 Ilirus</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.2.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous></main><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#什么是vhd>什么是VHD</a></li><li><a href=#什么是vhdx>什么是VHDX</a></li><li><a href=#vhdvhdx的优点>VHD/VHDX的优点</a></li></ol><ol><li><a href=#安装简便>安装简便</a></li><li><a href=#性能强劲>性能强劲</a></li><li><a href=#备份方便>备份方便</a></li><li><a href=#删除方便>删除方便</a></li></ol><ol><li><a href=#创建vhdvhdx文件>创建VHD/VHDX文件</a></li><li><a href=#部署windows系统到vhd虚拟磁盘>部署Windows系统到VHD虚拟磁盘</a></li><li><a href=#添加引导项>添加引导项</a></li></ol><ol><li><a href=#差分磁盘如何实现秒备份秒还原>差分磁盘如何实现“秒备份”，“秒还原”</a></li></ol></nav></div></section></aside></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous defer></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const a=document.createElement('link');a.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",a.type="text/css",a.rel="stylesheet",document.head.appendChild(a)})()</script></body></html>